<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Tracking color objects with GoCV | Matias Pan's blog</title>
<meta name=keywords content="go"><meta name=description content="Disclaimer: this blog post is just a port of Adrian&rsquo;s tutorial at pyimagesearch where he shows how to track a ball using Python and OpenCV. I only changed a few things here and there and rewrote it using Go and GoCV. So all the credit should go to him
I always prefer to start by showing what you&rsquo;ll get if you stick to the end, so here it goes:
Hooked? Awesome."><meta name=author content="matipan"><link rel=canonical href=https://blog.matiaspan.dev/posts/box-tracking-with-gocv/><link crossorigin=anonymous href=/assets/css/stylesheet.a801c217e3c96db9c9df36cb1d2216a9bc5d9fa77b72e2afcdf47fb847f8f015.css integrity="sha256-qAHCF+PJbbnJ3zbLHSIWqbxdn6d7cuKvzfR/uEf48BU=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script><link rel=icon href=https://blog.matiaspan.dev/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=https://blog.matiaspan.dev/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=https://blog.matiaspan.dev/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=https://blog.matiaspan.dev/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://blog.matiaspan.dev/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><meta property="og:title" content="Tracking color objects with GoCV"><meta property="og:description" content="Disclaimer: this blog post is just a port of Adrian&rsquo;s tutorial at pyimagesearch where he shows how to track a ball using Python and OpenCV. I only changed a few things here and there and rewrote it using Go and GoCV. So all the credit should go to him
I always prefer to start by showing what you&rsquo;ll get if you stick to the end, so here it goes:
Hooked? Awesome."><meta property="og:type" content="article"><meta property="og:url" content="https://blog.matiaspan.dev/posts/box-tracking-with-gocv/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2018-10-19T00:00:00-03:00"><meta property="article:modified_time" content="2018-10-19T00:00:00-03:00"><meta property="og:site_name" content="Matias Pan's blog"><meta name=twitter:card content="summary"><meta name=twitter:title content="Tracking color objects with GoCV"><meta name=twitter:description content="Disclaimer: this blog post is just a port of Adrian&rsquo;s tutorial at pyimagesearch where he shows how to track a ball using Python and OpenCV. I only changed a few things here and there and rewrote it using Go and GoCV. So all the credit should go to him
I always prefer to start by showing what you&rsquo;ll get if you stick to the end, so here it goes:
Hooked? Awesome."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://blog.matiaspan.dev/posts/"},{"@type":"ListItem","position":2,"name":"Tracking color objects with GoCV","item":"https://blog.matiaspan.dev/posts/box-tracking-with-gocv/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Tracking color objects with GoCV","name":"Tracking color objects with GoCV","description":"Disclaimer: this blog post is just a port of Adrian\u0026rsquo;s tutorial at pyimagesearch where he shows how to track a ball using Python and OpenCV. I only changed a few things here and there and rewrote it using Go and GoCV. So all the credit should go to him\nI always prefer to start by showing what you\u0026rsquo;ll get if you stick to the end, so here it goes:\nHooked? Awesome.","keywords":["go"],"articleBody":"Disclaimer: this blog post is just a port of Adrian’s tutorial at pyimagesearch where he shows how to track a ball using Python and OpenCV. I only changed a few things here and there and rewrote it using Go and GoCV. So all the credit should go to him\nI always prefer to start by showing what you’ll get if you stick to the end, so here it goes:\nHooked? Awesome.\nHere are the two main sections of this post:\nFind the range of pixel values of an object in the HSV color space. Detect the presence of that object using thresholding techniques and track its movements Range of values in the HSV color space The HSV(hue, saturation, value) color space is a different way of representing colors:\nhue: this channel models the color type, this makes it useful for image processing tasks where we need to process objects based on its color. saturation: represents the different shades of gray or if it’s fully saturated, meaning there is no white component. value: describes the intensity or brightness of the color. Here is an image showing the HSV cylinder:\nLets write a program that will allow us to determine the range of pixel values of our object, these values will be necessary to track it later. Create a new folder somewhere and add a main.go file there with the following:\npackage main import ( \"gocv.io/x/gocv\" ) func main() { wi := gocv.NewWindow(\"normal\") wt := gocv.NewWindow(\"threshold\") wt.ResizeWindow(600, 600) wt.MoveWindow(0, 0) wi.MoveWindow(600, 0) wi.ResizeWindow(600, 600) lh := wi.CreateTrackbar(\"Low H\", 360/2) hh := wi.CreateTrackbar(\"High H\", 255) ls := wi.CreateTrackbar(\"Low S\", 255) hs := wi.CreateTrackbar(\"High S\", 255) lv := wi.CreateTrackbar(\"Low V\", 255) hv := wi.CreateTrackbar(\"High V\", 255) video, _ := gocv.OpenVideoCapture(0) img := gocv.NewMat() for { video.Read(\u0026img) gocv.CvtColor(img, \u0026img, gocv.ColorBGRToHSV) thresholded := gocv.NewMat() gocv.InRangeWithScalar(img, gocv.Scalar{Val1: getPosFloat(lh), Val2: getPosFloat(ls), Val3: getPosFloat(lv)}, gocv.Scalar{Val1: getPosFloat(hh), Val2: getPosFloat(hs), Val3: getPosFloat(hv)}, \u0026thresholded) wi.IMShow(img) wt.IMShow(thresholded) if wi.WaitKey(1) == 27 || wt.WaitKey(1) == 27 { break } } } func getPosFloat(t *gocv.Trackbar) float64 { return float64(t.GetPos()) } In the first 6 lines of the main function we create two different windows, one for our normal images and one for our filtered images. We also resize them so that they show up side by side.\nAfter that we create 6 different trackbars. These trackbars will allow you to control the high and low pixel values of each component of the HSV color space. You are going to need to play around with those bars in order to determine the true values of your object.\nNow for the important part. Each new frame we read inside the for loop gets converted to HSV using the CvtColor function. Once we have that we want to apply pixel-thresholding to our image using the InRangeWithScalar function. This function will leave us with a binary image where only the pixels that are in the ranges specified by the trackbars will be displayed.\nFinally we simply display both images.\nTo run this program be sure that your camera is in fact identified by the 0 index, if not then change that number to the one appropriate to your setup.\nIf all went well the following two windows should appear:\nNow it’s time to start playing around with those 6 trackbars you can see there. Each one of them modifies the high and low value of each of the three HSV components. Note that the values required to find the object you want will vary depending on the lighting of the room and the camera you are using.\nLets show an example of the values I needed to set in order to find the hoodie I was wearing:\nOnce you have those values make sure to write them down since you’ll need them for the next part.\nDetect and track the object In order to draw that red line you saw on the video we are going to need to implement a new structure. If you pay close attention you’ll see that the line fades away after a fixed number of points have been drawn. So, in order to only draw the points that we care about we are going to build our own queue that discards old elements when the buffer gets full:\npackage queue import \"image\" // Queue is a fixed-size queue that discards old // elements once it reached the maximum size. type Queue struct { data []image.Point size int } // New creates a new Queue with the specified size. func New(size uint) *Queue { return \u0026Queue{ data: []image.Point{}, size: int(size), } } // Clear clears all elements in the queue. func (q *Queue) Clear() { q.data = []image.Point{} } // Push pushes a new element into the queue. func (q *Queue) Push(p image.Point) { if len(q.data) == q.size { q.data = q.data[1 : q.size-1] } q.data = append(q.data, p) } // Range iterates over the elements of the queue // calling f for each element. func (q *Queue) Range(f func(p image.Point)) { for _, p := range q.data { f(p) } } // RangePrevious iterates over the elements of the queue // calling f for each pair of previous-current elements. func (q *Queue) RangePrevious(f func(current image.Point, previous image.Point)) { for i := 1; i \u003c len(q.data); i++ { f(q.data[i], q.data[i-1]) } } The basic idea of this structure is to basically provide a way to push data into the queue discarding old elements once we reach the maximum size we specified. It also provides the RangePrevious function that allows the user of the queue to range over the data using both the current item and the previous item, you’ll see in a bit why we need this. You can find this package here.\nTime to actually track the object. Open up a new main.go file and we’ll start by initializing the basic data structures we’ll need:\npackage main import ( \"image\" \"image/color\" \"github.com/matipan/computer-vision/queue\" \"gocv.io/x/gocv\" ) var ( lhsv = gocv.Scalar{Val1: 49, Val2: 89, Val3: 0} hhsv = gocv.Scalar{Val1: 109, Val2: 255, Val3: 255} size = image.Point{X: 600, Y: 600} wt = gocv.NewWindow(\"thersholded\") wi = gocv.NewWindow(\"images\") img = gocv.NewMat() mask = gocv.NewMat() frame = gocv.NewMat() hsv = gocv.NewMat() kernel = gocv.NewMat() ) func main() { defer close() wt.ResizeWindow(600, 600) wt.MoveWindow(0, 0) wi.MoveWindow(600, 0) wi.ResizeWindow(600, 600) video, _ := gocv.OpenVideoCapture(0) defer video.Close() queue := queue.New(40) for { video.Read(\u0026img) if imShow() { break } } } func imShow() bool { wi.IMShow(img) wt.IMShow(mask) return wi.WaitKey(1) == 27 || wt.WaitKey(1) == 27 } func close() { defer img.Close() defer mask.Close() defer frame.Close() defer hsv.Close() defer kernel.Close() defer wi.Close() defer wt.Close() } Lets start from the beginning. First, we are defining the low and high pixel values of our object in the HSV color space:\nlhsv = gocv.Scalar{Val1: 49, Val2: 89, Val3: 0} hhsv = gocv.Scalar{Val1: 109, Val2: 255, Val3: 255} Modify those values to match the ones you found before. lhsv represents the low values and hhsv represents the high values. Val1, Val2 and Val3 represent each HSV component in order.\nNext we initialize all the Mats we are going to need to apply our filters and the windows we’ll use to display the images.\nWe also initialized our queue with a size of 40. This means that the maximum length of our line will be 40. If you want a bigger line simply increase that number. Finally, we read new frames from our webcam and display them using our convenience imShow function. If you want to quit the program you can hit escape at any time. Note that this program wont compile since we have not used our queue yet.\nTo each new frame we read we need to apply a few filters before we can find our object:\ngocv.Flip(img, \u0026img, 1) gocv.Resize(img, \u0026img, size, 0, 0, gocv.InterpolationLinear) gocv.GaussianBlur(img, \u0026frame, image.Point{X: 21, Y: 21}, 0, 0, gocv.BorderReflect101) gocv.CvtColor(frame, \u0026hsv, gocv.ColorBGRToHSV) Flip flips the image vertically, this is not necessary but I think it looks better. After that we Resize our image, apply a Gaussian filter to blur the image and convert its color to HSV with CvtColor.\nNow that our image is filtered we can look for our object:\ngocv.InRangeWithScalar(hsv, lhsv, hhsv, \u0026mask) gocv.Erode(mask, \u0026mask, kernel) gocv.Dilate(mask, \u0026mask, kernel) cnt := bestContour(mask, 2000) InRangeWithScalar finds all pixels in our image that are between the range of pixel values defined by lhsv and hhsv. After that we perform an Erosion and Dilation to expand the pixels that were in that range. Finally we find the biggest contour in our image. If you read my previous blog post you’ll be familiar with the bestContour function. But in case you didn’t here it is:\n// bestContour obtains the biggest contour in the frame(provided is bigger) // than the minArea. func bestContour(frame gocv.Mat, minArea float64) []image.Point { cnts := gocv.FindContours(frame, gocv.RetrievalExternal, gocv.ChainApproxSimple) var ( bestCnt []image.Point bestArea = minArea ) for _, cnt := range cnts { if area := gocv.ContourArea(cnt); area \u003e bestArea { bestArea = area bestCnt = cnt } } return bestCnt } This function will return the biggest contour found in the image as long as the area of that contour is bigger than minArea.\nOnce we have our contour we can draw the rectangle around it, this can be done easily with BoundingRect and Rectangle:\nrect := gocv.BoundingRect(cnt) gocv.Rectangle(\u0026img, rect, color.RGBA{G: 255}, 2) To draw the line that follows the movement of the object we first need to get the center of the rectangle:\n// middle calculates the middle x and y of a rectangle. func middle(rect image.Rectangle) (x int, y int) { return (rect.Max.X-rect.Min.X)/2 + rect.Min.X, (rect.Max.Y-rect.Min.Y)/2 + rect.Min.Y } Finally we are going to use our queue to push the center coordinates of the rectangle, range over all the elements of the queue and display the connection between each of the points using the Line function:\nrect := gocv.BoundingRect(cnt) gocv.Rectangle(\u0026img, rect, color.RGBA{G: 255}, 2) x, y := middle(rect) queue.Push(image.Point{X: x, Y: y}) queue.RangePrevious(func(c image.Point, p image.Point) { gocv.Line(\u0026img, p, c, color.RGBA{R: 255}, 2) }) Lets put everything together now:\npackage main import ( \"image\" \"image/color\" \"github.com/matipan/computer-vision/queue\" \"gocv.io/x/gocv\" ) var ( rcolor = color.RGBA{G: 255, A: 255} lcolor = color.RGBA{R: 255, A: 255} lhsv = gocv.Scalar{Val1: 49, Val2: 89, Val3: 0} hhsv = gocv.Scalar{Val1: 109, Val2: 255, Val3: 255} size = image.Point{X: 600, Y: 600} blur = image.Point{X: 11, Y: 11} wt = gocv.NewWindow(\"thersholded\") wi = gocv.NewWindow(\"images\") img = gocv.NewMat() mask = gocv.NewMat() frame = gocv.NewMat() hsv = gocv.NewMat() kernel = gocv.NewMat() ) func main() { defer close() wt.ResizeWindow(600, 600) wt.MoveWindow(0, 0) wi.MoveWindow(600, 0) wi.ResizeWindow(600, 600) video, _ := gocv.OpenVideoCapture(0) defer video.Close() queue := queue.New(40) for { if !video.Read(\u0026img) { break } gocv.Flip(img, \u0026img, 1) gocv.Resize(img, \u0026img, size, 0, 0, gocv.InterpolationLinear) gocv.GaussianBlur(img, \u0026frame, blur, 0, 0, gocv.BorderReflect101) gocv.CvtColor(frame, \u0026hsv, gocv.ColorBGRToHSV) gocv.InRangeWithScalar(hsv, lhsv, hhsv, \u0026mask) gocv.Erode(mask, \u0026mask, kernel) gocv.Dilate(mask, \u0026mask, kernel) cnt := bestContour(mask, 2000) if len(cnt) == 0 { queue.Clear() if imShow() { break } continue } rect := gocv.BoundingRect(cnt) gocv.Rectangle(\u0026img, rect, rcolor, 2) x, y := middle(rect) queue.Push(image.Point{X: x, Y: y}) queue.RangePrevious(func(c image.Point, p image.Point) { gocv.Line(\u0026img, p, c, lcolor, 2) }) if imShow() { break } } } func imShow() bool { wi.IMShow(img) wt.IMShow(mask) return wi.WaitKey(1) == 27 || wt.WaitKey(1) == 27 } // bestContour obtains the biggest contour in the frame(provided is bigger) // than the minArea. func bestContour(frame gocv.Mat, minArea float64) []image.Point { cnts := gocv.FindContours(frame, gocv.RetrievalExternal, gocv.ChainApproxSimple) var ( bestCnt []image.Point bestArea = minArea ) for _, cnt := range cnts { if area := gocv.ContourArea(cnt); area \u003e bestArea { bestArea = area bestCnt = cnt } } return bestCnt } // middle calculates the middle x and y of a rectangle. func middle(rect image.Rectangle) (x int, y int) { return (rect.Max.X-rect.Min.X)/2 + rect.Min.X, (rect.Max.Y-rect.Min.Y)/2 + rect.Min.Y } func close() { defer wi.Close() defer wt.Close() defer img.Close() defer mask.Close() defer frame.Close() defer hsv.Close() defer kernel.Close() } Remember to set your own values for lhsv and hhsv.\nIf all went well after you run this program and start moving the object you’ll see something similar to this:\nYAS! High five yourself!!\nConclusion In this blog post we tweaked a bit Adrian’s ball tracking blog post to use the functions that we have available in GoCV. If you follow his blog post you’ll see that he used a function called minEnclosingCircle. This function allows you to get a circle around your contour that you can then draw on the image. The problem is that GoCV has not that implemented that function yet, although they have it on their Roadmap. This is why I decided to simply draw a rectangle but still do the fun part(at least for me) of drawing the line that follows the object.\nHope you enjoyed this and thanks for reading! Until next time!\n","wordCount":"2113","inLanguage":"en","datePublished":"2018-10-19T00:00:00-03:00","dateModified":"2018-10-19T00:00:00-03:00","author":{"@type":"Person","name":"matipan"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.matiaspan.dev/posts/box-tracking-with-gocv/"},"publisher":{"@type":"Organization","name":"Matias Pan's blog","logo":{"@type":"ImageObject","url":"https://blog.matiaspan.dev/%3Clink%20/%20abs%20url%3E"}}}</script></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://blog.matiaspan.dev/ accesskey=h title="Home (Alt + H)"><img src=https://blog.matiaspan.dev/apple-touch-icon.png alt aria-label=logo height=35>Home</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://blog.matiaspan.dev/archives/ title=Archive><span>Archive</span></a></li><li><a href=https://blog.matiaspan.dev/search/ title=Search><span>Search</span></a></li><li><a href=https://blog.matiaspan.dev/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://blog.matiaspan.dev/tags/ title=Tags><span>Tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>Tracking color objects with GoCV</h1><div class=post-meta><span title='2018-10-19 00:00:00 -0300 -03'>October 19, 2018</span>&nbsp;·&nbsp;10 min&nbsp;·&nbsp;matipan&nbsp;|&nbsp;<a href=https://github.com/matipan/matipan.github.io/tree/main/content/posts/box-tracking-with-gocv.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#range-of-values-in-the-hsv-color-space>Range of values in the HSV color space</a></li><li><a href=#detect-and-track-the-object>Detect and track the object</a></li><li><a href=#conclusion>Conclusion</a></li></ul></nav></div></details></div><div class=post-content><p><em>Disclaimer</em>: this blog post is just a port of <a href=https://www.pyimagesearch.com/2015/09/14/ball-tracking-with-opencv/>Adrian&rsquo;s tutorial at pyimagesearch</a> where he shows how to track a ball using Python and OpenCV. I only changed a few things here and there and rewrote it using Go and <a href=https://gocv.io>GoCV</a>. So all the credit should go to him</p><p>I always prefer to start by showing what you&rsquo;ll get if you stick to the end, so here it goes:</p><p><img loading=lazy src=/images/box-tracking.gif alt=box-tracking></p><p>Hooked? Awesome.<br>Here are the two main sections of this post:</p><ul><li>Find the range of pixel values of an object in the <strong>HSV</strong> color space.</li><li>Detect the presence of that object using thresholding techniques and track its movements</li></ul><h2 id=range-of-values-in-the-hsv-color-space>Range of values in the HSV color space<a hidden class=anchor aria-hidden=true href=#range-of-values-in-the-hsv-color-space>#</a></h2><p>The <strong>HSV(hue, saturation, value)</strong> color space is a different way of representing colors:</p><ul><li><strong>hue</strong>: this channel models the color type, this makes it useful for image processing tasks where we need to process objects based on its color.</li><li><strong>saturation</strong>: represents the different shades of gray or if it&rsquo;s fully saturated, meaning there is no white component.</li><li><strong>value</strong>: describes the intensity or brightness of the color.</li></ul><p>Here is an image showing the <strong>HSV</strong> cylinder:</p><p><img loading=lazy src=/images/hsv-cylinder.jpg alt=hsv-cylinder></p><p>Lets write a program that will allow us to determine the range of pixel values of our object, these values will be necessary to track it later. Create a new folder somewhere and add a <code>main.go</code> file there with the following:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;gocv.io/x/gocv&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>wi</span> <span class=o>:=</span> <span class=nx>gocv</span><span class=p>.</span><span class=nf>NewWindow</span><span class=p>(</span><span class=s>&#34;normal&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>wt</span> <span class=o>:=</span> <span class=nx>gocv</span><span class=p>.</span><span class=nf>NewWindow</span><span class=p>(</span><span class=s>&#34;threshold&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>wt</span><span class=p>.</span><span class=nf>ResizeWindow</span><span class=p>(</span><span class=mi>600</span><span class=p>,</span> <span class=mi>600</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>wt</span><span class=p>.</span><span class=nf>MoveWindow</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>wi</span><span class=p>.</span><span class=nf>MoveWindow</span><span class=p>(</span><span class=mi>600</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>wi</span><span class=p>.</span><span class=nf>ResizeWindow</span><span class=p>(</span><span class=mi>600</span><span class=p>,</span> <span class=mi>600</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nx>lh</span> <span class=o>:=</span> <span class=nx>wi</span><span class=p>.</span><span class=nf>CreateTrackbar</span><span class=p>(</span><span class=s>&#34;Low H&#34;</span><span class=p>,</span> <span class=mi>360</span><span class=o>/</span><span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>hh</span> <span class=o>:=</span> <span class=nx>wi</span><span class=p>.</span><span class=nf>CreateTrackbar</span><span class=p>(</span><span class=s>&#34;High H&#34;</span><span class=p>,</span> <span class=mi>255</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>ls</span> <span class=o>:=</span> <span class=nx>wi</span><span class=p>.</span><span class=nf>CreateTrackbar</span><span class=p>(</span><span class=s>&#34;Low S&#34;</span><span class=p>,</span> <span class=mi>255</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>hs</span> <span class=o>:=</span> <span class=nx>wi</span><span class=p>.</span><span class=nf>CreateTrackbar</span><span class=p>(</span><span class=s>&#34;High S&#34;</span><span class=p>,</span> <span class=mi>255</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>lv</span> <span class=o>:=</span> <span class=nx>wi</span><span class=p>.</span><span class=nf>CreateTrackbar</span><span class=p>(</span><span class=s>&#34;Low V&#34;</span><span class=p>,</span> <span class=mi>255</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>hv</span> <span class=o>:=</span> <span class=nx>wi</span><span class=p>.</span><span class=nf>CreateTrackbar</span><span class=p>(</span><span class=s>&#34;High V&#34;</span><span class=p>,</span> <span class=mi>255</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nx>video</span><span class=p>,</span> <span class=nx>_</span> <span class=o>:=</span> <span class=nx>gocv</span><span class=p>.</span><span class=nf>OpenVideoCapture</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>img</span> <span class=o>:=</span> <span class=nx>gocv</span><span class=p>.</span><span class=nf>NewMat</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=k>for</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>video</span><span class=p>.</span><span class=nf>Read</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>img</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=nx>gocv</span><span class=p>.</span><span class=nf>CvtColor</span><span class=p>(</span><span class=nx>img</span><span class=p>,</span> <span class=o>&amp;</span><span class=nx>img</span><span class=p>,</span> <span class=nx>gocv</span><span class=p>.</span><span class=nx>ColorBGRToHSV</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=nx>thresholded</span> <span class=o>:=</span> <span class=nx>gocv</span><span class=p>.</span><span class=nf>NewMat</span><span class=p>()</span>
</span></span><span class=line><span class=cl>		<span class=nx>gocv</span><span class=p>.</span><span class=nf>InRangeWithScalar</span><span class=p>(</span><span class=nx>img</span><span class=p>,</span>
</span></span><span class=line><span class=cl>			<span class=nx>gocv</span><span class=p>.</span><span class=nx>Scalar</span><span class=p>{</span><span class=nx>Val1</span><span class=p>:</span> <span class=nf>getPosFloat</span><span class=p>(</span><span class=nx>lh</span><span class=p>),</span> <span class=nx>Val2</span><span class=p>:</span> <span class=nf>getPosFloat</span><span class=p>(</span><span class=nx>ls</span><span class=p>),</span> <span class=nx>Val3</span><span class=p>:</span> <span class=nf>getPosFloat</span><span class=p>(</span><span class=nx>lv</span><span class=p>)},</span>
</span></span><span class=line><span class=cl>			<span class=nx>gocv</span><span class=p>.</span><span class=nx>Scalar</span><span class=p>{</span><span class=nx>Val1</span><span class=p>:</span> <span class=nf>getPosFloat</span><span class=p>(</span><span class=nx>hh</span><span class=p>),</span> <span class=nx>Val2</span><span class=p>:</span> <span class=nf>getPosFloat</span><span class=p>(</span><span class=nx>hs</span><span class=p>),</span> <span class=nx>Val3</span><span class=p>:</span> <span class=nf>getPosFloat</span><span class=p>(</span><span class=nx>hv</span><span class=p>)},</span>
</span></span><span class=line><span class=cl>			<span class=o>&amp;</span><span class=nx>thresholded</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>		<span class=nx>wi</span><span class=p>.</span><span class=nf>IMShow</span><span class=p>(</span><span class=nx>img</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=nx>wt</span><span class=p>.</span><span class=nf>IMShow</span><span class=p>(</span><span class=nx>thresholded</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=nx>wi</span><span class=p>.</span><span class=nf>WaitKey</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span> <span class=o>==</span> <span class=mi>27</span> <span class=o>||</span> <span class=nx>wt</span><span class=p>.</span><span class=nf>WaitKey</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span> <span class=o>==</span> <span class=mi>27</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=k>break</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>getPosFloat</span><span class=p>(</span><span class=nx>t</span> <span class=o>*</span><span class=nx>gocv</span><span class=p>.</span><span class=nx>Trackbar</span><span class=p>)</span> <span class=kt>float64</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nb>float64</span><span class=p>(</span><span class=nx>t</span><span class=p>.</span><span class=nf>GetPos</span><span class=p>())</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>In the first 6 lines of the main function we create two different windows, one for our normal images and one for our filtered images. We also resize them so that they show up side by side.<br>After that we create 6 different trackbars. These trackbars will allow you to control the high and low pixel values of each component of the HSV color space. You are going to need to play around with those bars in order to determine the true values of your object.<br>Now for the important part. Each new frame we read inside the <code>for</code> loop gets converted to <code>HSV</code> using the <a href=https://godoc.org/gocv.io/x/gocv#CvtColor>CvtColor</a> function. Once we have that we want to apply pixel-thresholding to our image using the <a href=https://godoc.org/gocv.io/x/gocv#InRangeWithScalar>InRangeWithScalar</a> function. This function will leave us with a binary image where only the pixels that are in the ranges specified by the trackbars will be displayed.<br>Finally we simply display both images.<br>To run this program be sure that your camera is in fact identified by the <code>0</code> index, if not then change that number to the one appropriate to your setup.<br>If all went well the following two windows should appear:</p><p><img loading=lazy src=/images/range-detector.png alt=range-detector></p><p>Now it&rsquo;s time to start playing around with those 6 trackbars you can see there. Each one of them modifies the high and low value of each of the three <strong>HSV</strong> components. Note that the values required to find the object you want will vary depending on the lighting of the room and the camera you are using.<br>Lets show an example of the values I needed to set in order to find the hoodie I was wearing:</p><p><img loading=lazy src=/images/range-detector-found.png alt=hoodie></p><p>Once you have those values make sure to write them down since you&rsquo;ll need them for the next part.</p><h2 id=detect-and-track-the-object>Detect and track the object<a hidden class=anchor aria-hidden=true href=#detect-and-track-the-object>#</a></h2><p>In order to draw that red line you saw on the video we are going to need to implement a new structure. If you pay close attention you&rsquo;ll see that the line fades away after a fixed number of points have been drawn. So, in order to only draw the points that we care about we are going to build our own queue that discards old elements when the buffer gets full:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>queue</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=s>&#34;image&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Queue is a fixed-size queue that discards old
</span></span></span><span class=line><span class=cl><span class=c1>// elements once it reached the maximum size.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>Queue</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>data</span> <span class=p>[]</span><span class=nx>image</span><span class=p>.</span><span class=nx>Point</span>
</span></span><span class=line><span class=cl>	<span class=nx>size</span> <span class=kt>int</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// New creates a new Queue with the specified size.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=nf>New</span><span class=p>(</span><span class=nx>size</span> <span class=kt>uint</span><span class=p>)</span> <span class=o>*</span><span class=nx>Queue</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=o>&amp;</span><span class=nx>Queue</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>data</span><span class=p>:</span> <span class=p>[]</span><span class=nx>image</span><span class=p>.</span><span class=nx>Point</span><span class=p>{},</span>
</span></span><span class=line><span class=cl>		<span class=nx>size</span><span class=p>:</span> <span class=nb>int</span><span class=p>(</span><span class=nx>size</span><span class=p>),</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Clear clears all elements in the queue.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=p>(</span><span class=nx>q</span> <span class=o>*</span><span class=nx>Queue</span><span class=p>)</span> <span class=nf>Clear</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>q</span><span class=p>.</span><span class=nx>data</span> <span class=p>=</span> <span class=p>[]</span><span class=nx>image</span><span class=p>.</span><span class=nx>Point</span><span class=p>{}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Push pushes a new element into the queue.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=p>(</span><span class=nx>q</span> <span class=o>*</span><span class=nx>Queue</span><span class=p>)</span> <span class=nf>Push</span><span class=p>(</span><span class=nx>p</span> <span class=nx>image</span><span class=p>.</span><span class=nx>Point</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=nx>q</span><span class=p>.</span><span class=nx>data</span><span class=p>)</span> <span class=o>==</span> <span class=nx>q</span><span class=p>.</span><span class=nx>size</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>q</span><span class=p>.</span><span class=nx>data</span> <span class=p>=</span> <span class=nx>q</span><span class=p>.</span><span class=nx>data</span><span class=p>[</span><span class=mi>1</span> <span class=p>:</span> <span class=nx>q</span><span class=p>.</span><span class=nx>size</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>q</span><span class=p>.</span><span class=nx>data</span> <span class=p>=</span> <span class=nb>append</span><span class=p>(</span><span class=nx>q</span><span class=p>.</span><span class=nx>data</span><span class=p>,</span> <span class=nx>p</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Range iterates over the elements of the queue
</span></span></span><span class=line><span class=cl><span class=c1>// calling f for each element.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=p>(</span><span class=nx>q</span> <span class=o>*</span><span class=nx>Queue</span><span class=p>)</span> <span class=nf>Range</span><span class=p>(</span><span class=nx>f</span> <span class=kd>func</span><span class=p>(</span><span class=nx>p</span> <span class=nx>image</span><span class=p>.</span><span class=nx>Point</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span> <span class=nx>_</span><span class=p>,</span> <span class=nx>p</span> <span class=o>:=</span> <span class=k>range</span> <span class=nx>q</span><span class=p>.</span><span class=nx>data</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nf>f</span><span class=p>(</span><span class=nx>p</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// RangePrevious iterates over the elements of the queue
</span></span></span><span class=line><span class=cl><span class=c1>// calling f for each pair of previous-current elements.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=p>(</span><span class=nx>q</span> <span class=o>*</span><span class=nx>Queue</span><span class=p>)</span> <span class=nf>RangePrevious</span><span class=p>(</span><span class=nx>f</span> <span class=kd>func</span><span class=p>(</span><span class=nx>current</span> <span class=nx>image</span><span class=p>.</span><span class=nx>Point</span><span class=p>,</span> <span class=nx>previous</span> <span class=nx>image</span><span class=p>.</span><span class=nx>Point</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span> <span class=nx>i</span> <span class=o>:=</span> <span class=mi>1</span><span class=p>;</span> <span class=nx>i</span> <span class=p>&lt;</span> <span class=nb>len</span><span class=p>(</span><span class=nx>q</span><span class=p>.</span><span class=nx>data</span><span class=p>);</span> <span class=nx>i</span><span class=o>++</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nf>f</span><span class=p>(</span><span class=nx>q</span><span class=p>.</span><span class=nx>data</span><span class=p>[</span><span class=nx>i</span><span class=p>],</span> <span class=nx>q</span><span class=p>.</span><span class=nx>data</span><span class=p>[</span><span class=nx>i</span><span class=o>-</span><span class=mi>1</span><span class=p>])</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>The basic idea of this structure is to basically provide a way to push data into the queue discarding old elements once we reach the maximum size we specified. It also provides the <code>RangePrevious</code> function that allows the user of the queue to range over the data using both the current item and the previous item, you&rsquo;ll see in a bit why we need this. You can find this package <a href=https://github.com/matipan/computer-vision/tree/master/queue>here</a>.</p><p>Time to actually track the object. Open up a new <code>main.go</code> file and we&rsquo;ll start by initializing the basic data structures we&rsquo;ll need:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;image&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;image/color&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=s>&#34;github.com/matipan/computer-vision/queue&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;gocv.io/x/gocv&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=nx>lhsv</span> <span class=p>=</span> <span class=nx>gocv</span><span class=p>.</span><span class=nx>Scalar</span><span class=p>{</span><span class=nx>Val1</span><span class=p>:</span> <span class=mi>49</span><span class=p>,</span> <span class=nx>Val2</span><span class=p>:</span> <span class=mi>89</span><span class=p>,</span> <span class=nx>Val3</span><span class=p>:</span> <span class=mi>0</span><span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>hhsv</span> <span class=p>=</span> <span class=nx>gocv</span><span class=p>.</span><span class=nx>Scalar</span><span class=p>{</span><span class=nx>Val1</span><span class=p>:</span> <span class=mi>109</span><span class=p>,</span> <span class=nx>Val2</span><span class=p>:</span> <span class=mi>255</span><span class=p>,</span> <span class=nx>Val3</span><span class=p>:</span> <span class=mi>255</span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nx>size</span> <span class=p>=</span> <span class=nx>image</span><span class=p>.</span><span class=nx>Point</span><span class=p>{</span><span class=nx>X</span><span class=p>:</span> <span class=mi>600</span><span class=p>,</span> <span class=nx>Y</span><span class=p>:</span> <span class=mi>600</span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nx>wt</span>   <span class=p>=</span> <span class=nx>gocv</span><span class=p>.</span><span class=nf>NewWindow</span><span class=p>(</span><span class=s>&#34;thersholded&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>wi</span>   <span class=p>=</span> <span class=nx>gocv</span><span class=p>.</span><span class=nf>NewWindow</span><span class=p>(</span><span class=s>&#34;images&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>img</span>  <span class=p>=</span> <span class=nx>gocv</span><span class=p>.</span><span class=nf>NewMat</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=nx>mask</span> <span class=p>=</span> <span class=nx>gocv</span><span class=p>.</span><span class=nf>NewMat</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=nx>frame</span> <span class=p>=</span> <span class=nx>gocv</span><span class=p>.</span><span class=nf>NewMat</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=nx>hsv</span> <span class=p>=</span> <span class=nx>gocv</span><span class=p>.</span><span class=nf>NewMat</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=nx>kernel</span> <span class=p>=</span> <span class=nx>gocv</span><span class=p>.</span><span class=nf>NewMat</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>defer</span> <span class=nb>close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nx>wt</span><span class=p>.</span><span class=nf>ResizeWindow</span><span class=p>(</span><span class=mi>600</span><span class=p>,</span> <span class=mi>600</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>wt</span><span class=p>.</span><span class=nf>MoveWindow</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>wi</span><span class=p>.</span><span class=nf>MoveWindow</span><span class=p>(</span><span class=mi>600</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>wi</span><span class=p>.</span><span class=nf>ResizeWindow</span><span class=p>(</span><span class=mi>600</span><span class=p>,</span> <span class=mi>600</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nx>video</span><span class=p>,</span> <span class=nx>_</span> <span class=o>:=</span> <span class=nx>gocv</span><span class=p>.</span><span class=nf>OpenVideoCapture</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>defer</span> <span class=nx>video</span><span class=p>.</span><span class=nf>Close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nx>queue</span> <span class=o>:=</span> <span class=nx>queue</span><span class=p>.</span><span class=nf>New</span><span class=p>(</span><span class=mi>40</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=k>for</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>video</span><span class=p>.</span><span class=nf>Read</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>img</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=nf>imShow</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=k>break</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>imShow</span><span class=p>()</span> <span class=kt>bool</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>wi</span><span class=p>.</span><span class=nf>IMShow</span><span class=p>(</span><span class=nx>img</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>wt</span><span class=p>.</span><span class=nf>IMShow</span><span class=p>(</span><span class=nx>mask</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>wi</span><span class=p>.</span><span class=nf>WaitKey</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span> <span class=o>==</span> <span class=mi>27</span> <span class=o>||</span> <span class=nx>wt</span><span class=p>.</span><span class=nf>WaitKey</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span> <span class=o>==</span> <span class=mi>27</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nb>close</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>defer</span> <span class=nx>img</span><span class=p>.</span><span class=nf>Close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=k>defer</span> <span class=nx>mask</span><span class=p>.</span><span class=nf>Close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=k>defer</span> <span class=nx>frame</span><span class=p>.</span><span class=nf>Close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=k>defer</span> <span class=nx>hsv</span><span class=p>.</span><span class=nf>Close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=k>defer</span> <span class=nx>kernel</span><span class=p>.</span><span class=nf>Close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=k>defer</span> <span class=nx>wi</span><span class=p>.</span><span class=nf>Close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=k>defer</span> <span class=nx>wt</span><span class=p>.</span><span class=nf>Close</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Lets start from the beginning. First, we are defining the low and high pixel values of our object in the <strong>HSV</strong> color space:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>lhsv</span> <span class=p>=</span> <span class=nx>gocv</span><span class=p>.</span><span class=nx>Scalar</span><span class=p>{</span><span class=nx>Val1</span><span class=p>:</span> <span class=mi>49</span><span class=p>,</span> <span class=nx>Val2</span><span class=p>:</span> <span class=mi>89</span><span class=p>,</span> <span class=nx>Val3</span><span class=p>:</span> <span class=mi>0</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=nx>hhsv</span> <span class=p>=</span> <span class=nx>gocv</span><span class=p>.</span><span class=nx>Scalar</span><span class=p>{</span><span class=nx>Val1</span><span class=p>:</span> <span class=mi>109</span><span class=p>,</span> <span class=nx>Val2</span><span class=p>:</span> <span class=mi>255</span><span class=p>,</span> <span class=nx>Val3</span><span class=p>:</span> <span class=mi>255</span><span class=p>}</span>
</span></span></code></pre></div><p>Modify those values to match the ones you found before. <code>lhsv</code> represents the <strong>low</strong> values and <code>hhsv</code> represents the <strong>high</strong> values. <strong>Val1</strong>, <strong>Val2</strong> and <strong>Val3</strong> represent each <strong>HSV</strong> component in order.<br>Next we initialize all the <a href=https://godoc.org/gocv.io/x/gocv#Mat>Mat</a>s we are going to need to apply our filters and the windows we&rsquo;ll use to display the images.<br>We also initialized our <code>queue</code> with a size of 40. This means that the maximum length of our line will be 40. If you want a bigger line simply increase that number. Finally, we read new frames from our webcam and display them using our convenience <code>imShow</code> function. If you want to quit the program you can hit <code>escape</code> at any time. Note that this program wont compile since we have not used our <code>queue</code> yet.</p><p>To each new frame we read we need to apply a few filters before we can find our object:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>gocv</span><span class=p>.</span><span class=nf>Flip</span><span class=p>(</span><span class=nx>img</span><span class=p>,</span> <span class=o>&amp;</span><span class=nx>img</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>gocv</span><span class=p>.</span><span class=nf>Resize</span><span class=p>(</span><span class=nx>img</span><span class=p>,</span> <span class=o>&amp;</span><span class=nx>img</span><span class=p>,</span> <span class=nx>size</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=nx>gocv</span><span class=p>.</span><span class=nx>InterpolationLinear</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>gocv</span><span class=p>.</span><span class=nf>GaussianBlur</span><span class=p>(</span><span class=nx>img</span><span class=p>,</span> <span class=o>&amp;</span><span class=nx>frame</span><span class=p>,</span> <span class=nx>image</span><span class=p>.</span><span class=nx>Point</span><span class=p>{</span><span class=nx>X</span><span class=p>:</span> <span class=mi>21</span><span class=p>,</span> <span class=nx>Y</span><span class=p>:</span> <span class=mi>21</span><span class=p>},</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=nx>gocv</span><span class=p>.</span><span class=nx>BorderReflect101</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>gocv</span><span class=p>.</span><span class=nf>CvtColor</span><span class=p>(</span><span class=nx>frame</span><span class=p>,</span> <span class=o>&amp;</span><span class=nx>hsv</span><span class=p>,</span> <span class=nx>gocv</span><span class=p>.</span><span class=nx>ColorBGRToHSV</span><span class=p>)</span>
</span></span></code></pre></div><p><a href=https://godoc.org/gocv.io/x/gocv#Flip>Flip</a> flips the image vertically, this is not necessary but I think it looks better. After that we <a href=https://godoc.org/gocv.io/x/gocv#Resize>Resize</a> our image, apply a <a href=https://godoc.org/gocv.io/x/gocv#GaussianBlur>Gaussian filter</a> to blur the image and convert its color to <strong>HSV</strong> with <a href=https://godoc.org/gocv.io/x/gocv#CvtColor>CvtColor</a>.<br>Now that our image is filtered we can look for our object:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>gocv</span><span class=p>.</span><span class=nf>InRangeWithScalar</span><span class=p>(</span><span class=nx>hsv</span><span class=p>,</span> <span class=nx>lhsv</span><span class=p>,</span> <span class=nx>hhsv</span><span class=p>,</span> <span class=o>&amp;</span><span class=nx>mask</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>gocv</span><span class=p>.</span><span class=nf>Erode</span><span class=p>(</span><span class=nx>mask</span><span class=p>,</span> <span class=o>&amp;</span><span class=nx>mask</span><span class=p>,</span> <span class=nx>kernel</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>gocv</span><span class=p>.</span><span class=nf>Dilate</span><span class=p>(</span><span class=nx>mask</span><span class=p>,</span> <span class=o>&amp;</span><span class=nx>mask</span><span class=p>,</span> <span class=nx>kernel</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>cnt</span> <span class=o>:=</span> <span class=nf>bestContour</span><span class=p>(</span><span class=nx>mask</span><span class=p>,</span> <span class=mi>2000</span><span class=p>)</span>
</span></span></code></pre></div><p><a href=https://godoc.org/gocv.io/x/gocv#InRangeWithScalar>InRangeWithScalar</a> finds all pixels in our image that are between the range of pixel values defined by <code>lhsv</code> and <code>hhsv</code>. After that we perform an <a href=https://godoc.org/gocv.io/x/gocv#Erode>Erosion</a> and <a href=https://godoc.org/gocv.io/x/gocv#Dilate>Dilation</a> to expand the pixels that were in that range. Finally we find the biggest contour in our image. If you read my <a href=http://matiaspan.me/posts/motion-tracking-turret-with-gobot-and-gocv/>previous blog post</a> you&rsquo;ll be familiar with the <code>bestContour</code> function. But in case you didn&rsquo;t here it is:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// bestContour obtains the biggest contour in the frame(provided is bigger)
</span></span></span><span class=line><span class=cl><span class=c1>// than the minArea.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=nf>bestContour</span><span class=p>(</span><span class=nx>frame</span> <span class=nx>gocv</span><span class=p>.</span><span class=nx>Mat</span><span class=p>,</span> <span class=nx>minArea</span> <span class=kt>float64</span><span class=p>)</span> <span class=p>[]</span><span class=nx>image</span><span class=p>.</span><span class=nx>Point</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>cnts</span> <span class=o>:=</span> <span class=nx>gocv</span><span class=p>.</span><span class=nf>FindContours</span><span class=p>(</span><span class=nx>frame</span><span class=p>,</span> <span class=nx>gocv</span><span class=p>.</span><span class=nx>RetrievalExternal</span><span class=p>,</span> <span class=nx>gocv</span><span class=p>.</span><span class=nx>ChainApproxSimple</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=kd>var</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>		<span class=nx>bestCnt</span>  <span class=p>[]</span><span class=nx>image</span><span class=p>.</span><span class=nx>Point</span>
</span></span><span class=line><span class=cl>		<span class=nx>bestArea</span> <span class=p>=</span> <span class=nx>minArea</span>
</span></span><span class=line><span class=cl>	<span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span> <span class=nx>_</span><span class=p>,</span> <span class=nx>cnt</span> <span class=o>:=</span> <span class=k>range</span> <span class=nx>cnts</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=nx>area</span> <span class=o>:=</span> <span class=nx>gocv</span><span class=p>.</span><span class=nf>ContourArea</span><span class=p>(</span><span class=nx>cnt</span><span class=p>);</span> <span class=nx>area</span> <span class=p>&gt;</span> <span class=nx>bestArea</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>bestArea</span> <span class=p>=</span> <span class=nx>area</span>
</span></span><span class=line><span class=cl>			<span class=nx>bestCnt</span> <span class=p>=</span> <span class=nx>cnt</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>bestCnt</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>This function will return the biggest contour found in the image as long as the area of that contour is bigger than <code>minArea</code>.</p><p>Once we have our contour we can draw the rectangle around it, this can be done easily with <a href=https://godoc.org/gocv.io/x/gocv#BoundingRect>BoundingRect</a> and <a href=https://godoc.org/gocv.io/x/gocv>Rectangle</a>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>rect</span> <span class=o>:=</span> <span class=nx>gocv</span><span class=p>.</span><span class=nf>BoundingRect</span><span class=p>(</span><span class=nx>cnt</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>gocv</span><span class=p>.</span><span class=nf>Rectangle</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>img</span><span class=p>,</span> <span class=nx>rect</span><span class=p>,</span> <span class=nx>color</span><span class=p>.</span><span class=nx>RGBA</span><span class=p>{</span><span class=nx>G</span><span class=p>:</span> <span class=mi>255</span><span class=p>},</span> <span class=mi>2</span><span class=p>)</span>
</span></span></code></pre></div><p>To draw the line that follows the movement of the object we first need to get the center of the rectangle:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// middle calculates the middle x and y of a rectangle.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=nf>middle</span><span class=p>(</span><span class=nx>rect</span> <span class=nx>image</span><span class=p>.</span><span class=nx>Rectangle</span><span class=p>)</span> <span class=p>(</span><span class=nx>x</span> <span class=kt>int</span><span class=p>,</span> <span class=nx>y</span> <span class=kt>int</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=p>(</span><span class=nx>rect</span><span class=p>.</span><span class=nx>Max</span><span class=p>.</span><span class=nx>X</span><span class=o>-</span><span class=nx>rect</span><span class=p>.</span><span class=nx>Min</span><span class=p>.</span><span class=nx>X</span><span class=p>)</span><span class=o>/</span><span class=mi>2</span> <span class=o>+</span> <span class=nx>rect</span><span class=p>.</span><span class=nx>Min</span><span class=p>.</span><span class=nx>X</span><span class=p>,</span> <span class=p>(</span><span class=nx>rect</span><span class=p>.</span><span class=nx>Max</span><span class=p>.</span><span class=nx>Y</span><span class=o>-</span><span class=nx>rect</span><span class=p>.</span><span class=nx>Min</span><span class=p>.</span><span class=nx>Y</span><span class=p>)</span><span class=o>/</span><span class=mi>2</span> <span class=o>+</span> <span class=nx>rect</span><span class=p>.</span><span class=nx>Min</span><span class=p>.</span><span class=nx>Y</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Finally we are going to use our <code>queue</code> to push the center coordinates of the rectangle, range over all the elements of the queue and display the connection between each of the points using the <a href=https://godoc.org/gocv.io/x/gocv#Line>Line</a> function:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>rect</span> <span class=o>:=</span> <span class=nx>gocv</span><span class=p>.</span><span class=nf>BoundingRect</span><span class=p>(</span><span class=nx>cnt</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>gocv</span><span class=p>.</span><span class=nf>Rectangle</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>img</span><span class=p>,</span> <span class=nx>rect</span><span class=p>,</span> <span class=nx>color</span><span class=p>.</span><span class=nx>RGBA</span><span class=p>{</span><span class=nx>G</span><span class=p>:</span> <span class=mi>255</span><span class=p>},</span> <span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>x</span><span class=p>,</span> <span class=nx>y</span> <span class=o>:=</span> <span class=nf>middle</span><span class=p>(</span><span class=nx>rect</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>queue</span><span class=p>.</span><span class=nf>Push</span><span class=p>(</span><span class=nx>image</span><span class=p>.</span><span class=nx>Point</span><span class=p>{</span><span class=nx>X</span><span class=p>:</span> <span class=nx>x</span><span class=p>,</span> <span class=nx>Y</span><span class=p>:</span> <span class=nx>y</span><span class=p>})</span>
</span></span><span class=line><span class=cl><span class=nx>queue</span><span class=p>.</span><span class=nf>RangePrevious</span><span class=p>(</span><span class=kd>func</span><span class=p>(</span><span class=nx>c</span> <span class=nx>image</span><span class=p>.</span><span class=nx>Point</span><span class=p>,</span> <span class=nx>p</span> <span class=nx>image</span><span class=p>.</span><span class=nx>Point</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>gocv</span><span class=p>.</span><span class=nf>Line</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>img</span><span class=p>,</span> <span class=nx>p</span><span class=p>,</span> <span class=nx>c</span><span class=p>,</span> <span class=nx>color</span><span class=p>.</span><span class=nx>RGBA</span><span class=p>{</span><span class=nx>R</span><span class=p>:</span> <span class=mi>255</span><span class=p>},</span> <span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></div><p>Lets put everything together now:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;image&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;image/color&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=s>&#34;github.com/matipan/computer-vision/queue&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;gocv.io/x/gocv&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=nx>rcolor</span> <span class=p>=</span> <span class=nx>color</span><span class=p>.</span><span class=nx>RGBA</span><span class=p>{</span><span class=nx>G</span><span class=p>:</span> <span class=mi>255</span><span class=p>,</span> <span class=nx>A</span><span class=p>:</span> <span class=mi>255</span><span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>lcolor</span> <span class=p>=</span> <span class=nx>color</span><span class=p>.</span><span class=nx>RGBA</span><span class=p>{</span><span class=nx>R</span><span class=p>:</span> <span class=mi>255</span><span class=p>,</span> <span class=nx>A</span><span class=p>:</span> <span class=mi>255</span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nx>lhsv</span> <span class=p>=</span> <span class=nx>gocv</span><span class=p>.</span><span class=nx>Scalar</span><span class=p>{</span><span class=nx>Val1</span><span class=p>:</span> <span class=mi>49</span><span class=p>,</span> <span class=nx>Val2</span><span class=p>:</span> <span class=mi>89</span><span class=p>,</span> <span class=nx>Val3</span><span class=p>:</span> <span class=mi>0</span><span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>hhsv</span> <span class=p>=</span> <span class=nx>gocv</span><span class=p>.</span><span class=nx>Scalar</span><span class=p>{</span><span class=nx>Val1</span><span class=p>:</span> <span class=mi>109</span><span class=p>,</span> <span class=nx>Val2</span><span class=p>:</span> <span class=mi>255</span><span class=p>,</span> <span class=nx>Val3</span><span class=p>:</span> <span class=mi>255</span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nx>size</span> <span class=p>=</span> <span class=nx>image</span><span class=p>.</span><span class=nx>Point</span><span class=p>{</span><span class=nx>X</span><span class=p>:</span> <span class=mi>600</span><span class=p>,</span> <span class=nx>Y</span><span class=p>:</span> <span class=mi>600</span><span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>blur</span> <span class=p>=</span> <span class=nx>image</span><span class=p>.</span><span class=nx>Point</span><span class=p>{</span><span class=nx>X</span><span class=p>:</span> <span class=mi>11</span><span class=p>,</span> <span class=nx>Y</span><span class=p>:</span> <span class=mi>11</span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nx>wt</span>     <span class=p>=</span> <span class=nx>gocv</span><span class=p>.</span><span class=nf>NewWindow</span><span class=p>(</span><span class=s>&#34;thersholded&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>wi</span>     <span class=p>=</span> <span class=nx>gocv</span><span class=p>.</span><span class=nf>NewWindow</span><span class=p>(</span><span class=s>&#34;images&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>img</span>    <span class=p>=</span> <span class=nx>gocv</span><span class=p>.</span><span class=nf>NewMat</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=nx>mask</span>   <span class=p>=</span> <span class=nx>gocv</span><span class=p>.</span><span class=nf>NewMat</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=nx>frame</span>  <span class=p>=</span> <span class=nx>gocv</span><span class=p>.</span><span class=nf>NewMat</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=nx>hsv</span>    <span class=p>=</span> <span class=nx>gocv</span><span class=p>.</span><span class=nf>NewMat</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=nx>kernel</span> <span class=p>=</span> <span class=nx>gocv</span><span class=p>.</span><span class=nf>NewMat</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>defer</span> <span class=nb>close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nx>wt</span><span class=p>.</span><span class=nf>ResizeWindow</span><span class=p>(</span><span class=mi>600</span><span class=p>,</span> <span class=mi>600</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>wt</span><span class=p>.</span><span class=nf>MoveWindow</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>wi</span><span class=p>.</span><span class=nf>MoveWindow</span><span class=p>(</span><span class=mi>600</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>wi</span><span class=p>.</span><span class=nf>ResizeWindow</span><span class=p>(</span><span class=mi>600</span><span class=p>,</span> <span class=mi>600</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nx>video</span><span class=p>,</span> <span class=nx>_</span> <span class=o>:=</span> <span class=nx>gocv</span><span class=p>.</span><span class=nf>OpenVideoCapture</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>defer</span> <span class=nx>video</span><span class=p>.</span><span class=nf>Close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nx>queue</span> <span class=o>:=</span> <span class=nx>queue</span><span class=p>.</span><span class=nf>New</span><span class=p>(</span><span class=mi>40</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=k>for</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=p>!</span><span class=nx>video</span><span class=p>.</span><span class=nf>Read</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>img</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=k>break</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>		<span class=nx>gocv</span><span class=p>.</span><span class=nf>Flip</span><span class=p>(</span><span class=nx>img</span><span class=p>,</span> <span class=o>&amp;</span><span class=nx>img</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=nx>gocv</span><span class=p>.</span><span class=nf>Resize</span><span class=p>(</span><span class=nx>img</span><span class=p>,</span> <span class=o>&amp;</span><span class=nx>img</span><span class=p>,</span> <span class=nx>size</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=nx>gocv</span><span class=p>.</span><span class=nx>InterpolationLinear</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=nx>gocv</span><span class=p>.</span><span class=nf>GaussianBlur</span><span class=p>(</span><span class=nx>img</span><span class=p>,</span> <span class=o>&amp;</span><span class=nx>frame</span><span class=p>,</span> <span class=nx>blur</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=nx>gocv</span><span class=p>.</span><span class=nx>BorderReflect101</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=nx>gocv</span><span class=p>.</span><span class=nf>CvtColor</span><span class=p>(</span><span class=nx>frame</span><span class=p>,</span> <span class=o>&amp;</span><span class=nx>hsv</span><span class=p>,</span> <span class=nx>gocv</span><span class=p>.</span><span class=nx>ColorBGRToHSV</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=nx>gocv</span><span class=p>.</span><span class=nf>InRangeWithScalar</span><span class=p>(</span><span class=nx>hsv</span><span class=p>,</span> <span class=nx>lhsv</span><span class=p>,</span> <span class=nx>hhsv</span><span class=p>,</span> <span class=o>&amp;</span><span class=nx>mask</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=nx>gocv</span><span class=p>.</span><span class=nf>Erode</span><span class=p>(</span><span class=nx>mask</span><span class=p>,</span> <span class=o>&amp;</span><span class=nx>mask</span><span class=p>,</span> <span class=nx>kernel</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=nx>gocv</span><span class=p>.</span><span class=nf>Dilate</span><span class=p>(</span><span class=nx>mask</span><span class=p>,</span> <span class=o>&amp;</span><span class=nx>mask</span><span class=p>,</span> <span class=nx>kernel</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=nx>cnt</span> <span class=o>:=</span> <span class=nf>bestContour</span><span class=p>(</span><span class=nx>mask</span><span class=p>,</span> <span class=mi>2000</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=nx>cnt</span><span class=p>)</span> <span class=o>==</span> <span class=mi>0</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>queue</span><span class=p>.</span><span class=nf>Clear</span><span class=p>()</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span> <span class=nf>imShow</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>				<span class=k>break</span>
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>			<span class=k>continue</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>		<span class=nx>rect</span> <span class=o>:=</span> <span class=nx>gocv</span><span class=p>.</span><span class=nf>BoundingRect</span><span class=p>(</span><span class=nx>cnt</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=nx>gocv</span><span class=p>.</span><span class=nf>Rectangle</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>img</span><span class=p>,</span> <span class=nx>rect</span><span class=p>,</span> <span class=nx>rcolor</span><span class=p>,</span> <span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=nx>x</span><span class=p>,</span> <span class=nx>y</span> <span class=o>:=</span> <span class=nf>middle</span><span class=p>(</span><span class=nx>rect</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=nx>queue</span><span class=p>.</span><span class=nf>Push</span><span class=p>(</span><span class=nx>image</span><span class=p>.</span><span class=nx>Point</span><span class=p>{</span><span class=nx>X</span><span class=p>:</span> <span class=nx>x</span><span class=p>,</span> <span class=nx>Y</span><span class=p>:</span> <span class=nx>y</span><span class=p>})</span>
</span></span><span class=line><span class=cl>		<span class=nx>queue</span><span class=p>.</span><span class=nf>RangePrevious</span><span class=p>(</span><span class=kd>func</span><span class=p>(</span><span class=nx>c</span> <span class=nx>image</span><span class=p>.</span><span class=nx>Point</span><span class=p>,</span> <span class=nx>p</span> <span class=nx>image</span><span class=p>.</span><span class=nx>Point</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>gocv</span><span class=p>.</span><span class=nf>Line</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>img</span><span class=p>,</span> <span class=nx>p</span><span class=p>,</span> <span class=nx>c</span><span class=p>,</span> <span class=nx>lcolor</span><span class=p>,</span> <span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=nf>imShow</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=k>break</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>imShow</span><span class=p>()</span> <span class=kt>bool</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>wi</span><span class=p>.</span><span class=nf>IMShow</span><span class=p>(</span><span class=nx>img</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>wt</span><span class=p>.</span><span class=nf>IMShow</span><span class=p>(</span><span class=nx>mask</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>wi</span><span class=p>.</span><span class=nf>WaitKey</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span> <span class=o>==</span> <span class=mi>27</span> <span class=o>||</span> <span class=nx>wt</span><span class=p>.</span><span class=nf>WaitKey</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span> <span class=o>==</span> <span class=mi>27</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// bestContour obtains the biggest contour in the frame(provided is bigger)
</span></span></span><span class=line><span class=cl><span class=c1>// than the minArea.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=nf>bestContour</span><span class=p>(</span><span class=nx>frame</span> <span class=nx>gocv</span><span class=p>.</span><span class=nx>Mat</span><span class=p>,</span> <span class=nx>minArea</span> <span class=kt>float64</span><span class=p>)</span> <span class=p>[]</span><span class=nx>image</span><span class=p>.</span><span class=nx>Point</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>cnts</span> <span class=o>:=</span> <span class=nx>gocv</span><span class=p>.</span><span class=nf>FindContours</span><span class=p>(</span><span class=nx>frame</span><span class=p>,</span> <span class=nx>gocv</span><span class=p>.</span><span class=nx>RetrievalExternal</span><span class=p>,</span> <span class=nx>gocv</span><span class=p>.</span><span class=nx>ChainApproxSimple</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=kd>var</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>		<span class=nx>bestCnt</span>  <span class=p>[]</span><span class=nx>image</span><span class=p>.</span><span class=nx>Point</span>
</span></span><span class=line><span class=cl>		<span class=nx>bestArea</span> <span class=p>=</span> <span class=nx>minArea</span>
</span></span><span class=line><span class=cl>	<span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span> <span class=nx>_</span><span class=p>,</span> <span class=nx>cnt</span> <span class=o>:=</span> <span class=k>range</span> <span class=nx>cnts</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=nx>area</span> <span class=o>:=</span> <span class=nx>gocv</span><span class=p>.</span><span class=nf>ContourArea</span><span class=p>(</span><span class=nx>cnt</span><span class=p>);</span> <span class=nx>area</span> <span class=p>&gt;</span> <span class=nx>bestArea</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>bestArea</span> <span class=p>=</span> <span class=nx>area</span>
</span></span><span class=line><span class=cl>			<span class=nx>bestCnt</span> <span class=p>=</span> <span class=nx>cnt</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>bestCnt</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// middle calculates the middle x and y of a rectangle.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=nf>middle</span><span class=p>(</span><span class=nx>rect</span> <span class=nx>image</span><span class=p>.</span><span class=nx>Rectangle</span><span class=p>)</span> <span class=p>(</span><span class=nx>x</span> <span class=kt>int</span><span class=p>,</span> <span class=nx>y</span> <span class=kt>int</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=p>(</span><span class=nx>rect</span><span class=p>.</span><span class=nx>Max</span><span class=p>.</span><span class=nx>X</span><span class=o>-</span><span class=nx>rect</span><span class=p>.</span><span class=nx>Min</span><span class=p>.</span><span class=nx>X</span><span class=p>)</span><span class=o>/</span><span class=mi>2</span> <span class=o>+</span> <span class=nx>rect</span><span class=p>.</span><span class=nx>Min</span><span class=p>.</span><span class=nx>X</span><span class=p>,</span> <span class=p>(</span><span class=nx>rect</span><span class=p>.</span><span class=nx>Max</span><span class=p>.</span><span class=nx>Y</span><span class=o>-</span><span class=nx>rect</span><span class=p>.</span><span class=nx>Min</span><span class=p>.</span><span class=nx>Y</span><span class=p>)</span><span class=o>/</span><span class=mi>2</span> <span class=o>+</span> <span class=nx>rect</span><span class=p>.</span><span class=nx>Min</span><span class=p>.</span><span class=nx>Y</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nb>close</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>defer</span> <span class=nx>wi</span><span class=p>.</span><span class=nf>Close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=k>defer</span> <span class=nx>wt</span><span class=p>.</span><span class=nf>Close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=k>defer</span> <span class=nx>img</span><span class=p>.</span><span class=nf>Close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=k>defer</span> <span class=nx>mask</span><span class=p>.</span><span class=nf>Close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=k>defer</span> <span class=nx>frame</span><span class=p>.</span><span class=nf>Close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=k>defer</span> <span class=nx>hsv</span><span class=p>.</span><span class=nf>Close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=k>defer</span> <span class=nx>kernel</span><span class=p>.</span><span class=nf>Close</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Remember to set your own values for <code>lhsv</code> and <code>hhsv</code>.<br>If all went well after you run this program and start moving the object you&rsquo;ll see something similar to this:</p><p><img loading=lazy src=/images/wallet-tracking.gif alt=wallet></p><p>YAS! High five yourself!!</p><p><img loading=lazy src=/images/self-five.gif alt=self-five></p><h2 id=conclusion>Conclusion<a hidden class=anchor aria-hidden=true href=#conclusion>#</a></h2><p>In this blog post we tweaked a bit <a href=https://www.pyimagesearch.com/2015/09/14/ball-tracking-with-opencv/>Adrian&rsquo;s ball tracking blog post</a> to use the functions that we have available in GoCV. If you follow his blog post you&rsquo;ll see that he used a function called <a href="https://docs.opencv.org/2.4/modules/imgproc/doc/structural_analysis_and_shape_descriptors.html?highlight=minenclosingcircle#minenclosingcircle">minEnclosingCircle</a>. This function allows you to get a circle around your contour that you can then draw on the image. The problem is that GoCV has not that implemented that function yet, although they have it on their <a href=https://github.com/hybridgroup/gocv/blob/master/ROADMAP.md>Roadmap</a>. This is why I decided to simply draw a rectangle but still do the fun part(at least for me) of drawing the line that follows the object.<br>Hope you enjoyed this and thanks for reading! Until next time!</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://blog.matiaspan.dev/tags/go/>go</a></li></ul><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share Tracking color objects with GoCV on x" href="https://x.com/intent/tweet/?text=Tracking%20color%20objects%20with%20GoCV&amp;url=https%3a%2f%2fblog.matiaspan.dev%2fposts%2fbox-tracking-with-gocv%2f&amp;hashtags=go"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Tracking color objects with GoCV on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fblog.matiaspan.dev%2fposts%2fbox-tracking-with-gocv%2f&title=Tracking%20color%20objects%20with%20GoCV"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Tracking color objects with GoCV on ycombinator" href="https://news.ycombinator.com/submitlink?t=Tracking%20color%20objects%20with%20GoCV&u=https%3a%2f%2fblog.matiaspan.dev%2fposts%2fbox-tracking-with-gocv%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentcolor" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></div></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://blog.matiaspan.dev/>Matias Pan's blog</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>